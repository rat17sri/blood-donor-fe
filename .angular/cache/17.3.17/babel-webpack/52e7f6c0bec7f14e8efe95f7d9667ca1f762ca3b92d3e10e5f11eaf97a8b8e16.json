{"ast":null,"code":"import { FormBuilder, Validators } from '@angular/forms';\nimport { AuthService } from '../../services/auth.service';\nimport { Router } from '@angular/router';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../services/auth.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/common\";\nfunction RegisterComponent_p_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 26);\n    i0.ɵɵtext(1, \" Fill in your details below to register as a blood donor. We\\u2019ll share your information only with verified organizations in need. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RegisterComponent_p_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 26);\n    i0.ɵɵtext(1, \" You can update your contact details and availability below. Your email is fixed and cannot be changed from this page. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RegisterComponent_label_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"label\", 6)(1, \"span\", 27);\n    i0.ɵɵtext(2, \"Name is required\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction RegisterComponent_label_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"label\", 6)(1, \"span\", 27);\n    i0.ɵɵtext(2, \"Valid email is required\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction RegisterComponent_label_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"label\", 6)(1, \"span\", 28);\n    i0.ɵɵtext(2, \" Email cannot be changed for an existing donor. \");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction RegisterComponent_div_20_label_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"label\", 6)(1, \"span\", 27);\n    i0.ɵɵtext(2, \" Password must be at least 6 characters \");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction RegisterComponent_div_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 5)(1, \"label\", 6)(2, \"span\", 7);\n    i0.ɵɵtext(3, \"Password\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(4, \"input\", 29);\n    i0.ɵɵtemplate(5, RegisterComponent_div_20_label_5_Template, 3, 0, \"label\", 9);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    let tmp_1_0;\n    let tmp_2_0;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵclassProp(\"input-error\", ((tmp_1_0 = ctx_r0.form.get(\"password\")) == null ? null : tmp_1_0.invalid) && ((tmp_1_0 = ctx_r0.form.get(\"password\")) == null ? null : tmp_1_0.touched));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ((tmp_2_0 = ctx_r0.form.get(\"password\")) == null ? null : tmp_2_0.invalid) && ((tmp_2_0 = ctx_r0.form.get(\"password\")) == null ? null : tmp_2_0.touched));\n  }\n}\nfunction RegisterComponent_label_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"label\", 6)(1, \"span\", 27);\n    i0.ɵɵtext(2, \"Phone is required\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction RegisterComponent_option_34_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 30);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const bg_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", bg_r2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(bg_r2);\n  }\n}\nfunction RegisterComponent_label_35_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"label\", 6)(1, \"span\", 27);\n    i0.ɵɵtext(2, \"Please select a blood group\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction RegisterComponent_label_41_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"label\", 6)(1, \"span\", 27);\n    i0.ɵɵtext(2, \"City is required\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction RegisterComponent_span_54_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.isUpdateMode ? \"Save Changes\" : \"Register\", \" \");\n  }\n}\nfunction RegisterComponent_span_55_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"span\", 31);\n  }\n}\nfunction RegisterComponent_span_56_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 32);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.successMsg, \" \");\n  }\n}\nfunction RegisterComponent_span_57_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 33);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.errorMsg, \" \");\n  }\n}\nexport let RegisterComponent = /*#__PURE__*/(() => {\n  class RegisterComponent {\n    constructor(fb, auth, router) {\n      this.fb = fb;\n      this.auth = auth;\n      this.router = router;\n      this.successMsg = '';\n      this.errorMsg = '';\n      this.loading = false;\n      this.isUpdateMode = false;\n      this.bloodGroups = ['A+', 'A-', 'B+', 'B-', 'AB+', 'AB-', 'O+', 'O-'];\n      this.form = this.fb.group({\n        name: ['', Validators.required],\n        email: ['', [Validators.required, Validators.email]],\n        password: ['', [Validators.required, Validators.minLength(6)]],\n        phone: ['', Validators.required],\n        bloodGroup: ['', Validators.required],\n        city: ['', Validators.required],\n        lastDonationDate: [''],\n        isAvailable: [true]\n      });\n    }\n    ngOnInit() {\n      // If logged in as donor, this page works as \"Update Donor Details\"\n      if (this.auth.isLoggedIn() && this.auth.isDonor()) {\n        this.isUpdateMode = true;\n        // Password is not needed in update mode\n        const passwordCtrl = this.form.get('password');\n        if (passwordCtrl) {\n          passwordCtrl.clearValidators();\n          passwordCtrl.updateValueAndValidity();\n        }\n        // Load existing profile and prefill the form\n        this.auth.getMe().subscribe({\n          next: user => {\n            this.form.patchValue({\n              name: user.name,\n              email: user.email,\n              phone: user.phone,\n              bloodGroup: user.bloodGroup,\n              city: user.city,\n              lastDonationDate: user.lastDonationDate ? user.lastDonationDate.substring(0, 10) : '',\n              isAvailable: user.isAvailable\n            });\n          },\n          error: err => {\n            console.error('Error loading profile', err);\n            // If something goes wrong, fallback to registration mode\n            this.isUpdateMode = false;\n          }\n        });\n      }\n    }\n    submit() {\n      this.successMsg = '';\n      this.errorMsg = '';\n      if (!this.isUpdateMode && this.form.invalid) {\n        this.form.markAllAsTouched();\n        return;\n      }\n      this.loading = true;\n      if (this.isUpdateMode) {\n        this.updateDonor();\n      } else {\n        this.registerDonor();\n      }\n    }\n    registerDonor() {\n      this.auth.register(this.form.value).subscribe({\n        next: () => {\n          this.loading = false;\n          this.successMsg = 'Registered successfully as donor.';\n          this.form.reset({\n            isAvailable: true\n          });\n        },\n        error: err => {\n          this.loading = false;\n          this.errorMsg = err?.error?.msg || 'Registration failed';\n        }\n      });\n    }\n    updateDonor() {\n      const {\n        name,\n        phone,\n        bloodGroup,\n        city,\n        lastDonationDate,\n        isAvailable\n      } = this.form.value;\n      const payload = {\n        name,\n        phone,\n        bloodGroup,\n        city,\n        lastDonationDate,\n        isAvailable\n      };\n      this.auth.updateMe(payload).subscribe({\n        next: () => {\n          this.loading = false;\n          this.successMsg = 'Donor details updated successfully.';\n        },\n        error: err => {\n          this.loading = false;\n          this.errorMsg = err?.error?.msg || 'Update failed';\n        }\n      });\n    }\n    cancelUpdate() {\n      if (this.isUpdateMode) {\n        this.router.navigateByUrl('/');\n      } else {\n        this.form.reset({\n          isAvailable: true\n        });\n      }\n    }\n    static {\n      this.ɵfac = function RegisterComponent_Factory(t) {\n        return new (t || RegisterComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.AuthService), i0.ɵɵdirectiveInject(i3.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: RegisterComponent,\n        selectors: [[\"app-register\"]],\n        decls: 58,\n        vars: 30,\n        consts: [[1, \"max-w-2xl\", \"mx-auto\"], [1, \"text-3xl\", \"font-bold\", \"mb-2\"], [\"class\", \"mb-6 opacity-80\", 4, \"ngIf\"], [1, \"card\", \"bg-base-100\", \"shadow-xl\", \"p-6\", \"space-y-4\", 3, \"ngSubmit\", \"formGroup\"], [1, \"grid\", \"md:grid-cols-2\", \"gap-4\"], [1, \"form-control\"], [1, \"label\"], [1, \"label-text\"], [\"type\", \"text\", \"formControlName\", \"name\", 1, \"input\", \"input-bordered\"], [\"class\", \"label\", 4, \"ngIf\"], [\"type\", \"email\", \"formControlName\", \"email\", 1, \"input\", \"input-bordered\", 3, \"readonly\"], [\"class\", \"form-control\", 4, \"ngIf\"], [\"type\", \"text\", \"formControlName\", \"phone\", 1, \"input\", \"input-bordered\"], [\"formControlName\", \"bloodGroup\", 1, \"select\", \"select-bordered\"], [\"value\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"text\", \"formControlName\", \"city\", 1, \"input\", \"input-bordered\"], [\"type\", \"date\", \"formControlName\", \"lastDonationDate\", 1, \"input\", \"input-bordered\"], [1, \"cursor-pointer\", \"label\"], [\"type\", \"checkbox\", \"formControlName\", \"isAvailable\", 1, \"toggle\", \"toggle-primary\"], [1, \"flex\", \"flex-wrap\", \"items-center\", \"gap-4\", \"pt-2\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", 3, \"disabled\"], [4, \"ngIf\"], [\"class\", \"loading loading-spinner\", 4, \"ngIf\"], [\"class\", \"text-success text-sm\", 4, \"ngIf\"], [\"class\", \"text-error text-sm\", 4, \"ngIf\"], [1, \"mb-6\", \"opacity-80\"], [1, \"label-text-alt\", \"text-error\"], [1, \"label-text-alt\", \"opacity-70\"], [\"type\", \"password\", \"formControlName\", \"password\", 1, \"input\", \"input-bordered\"], [3, \"value\"], [1, \"loading\", \"loading-spinner\"], [1, \"text-success\", \"text-sm\"], [1, \"text-error\", \"text-sm\"]],\n        template: function RegisterComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"h2\", 1);\n            i0.ɵɵtext(2);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(3, RegisterComponent_p_3_Template, 2, 0, \"p\", 2)(4, RegisterComponent_p_4_Template, 2, 0, \"p\", 2);\n            i0.ɵɵelementStart(5, \"form\", 3);\n            i0.ɵɵlistener(\"ngSubmit\", function RegisterComponent_Template_form_ngSubmit_5_listener() {\n              return ctx.submit();\n            });\n            i0.ɵɵelementStart(6, \"div\", 4)(7, \"div\", 5)(8, \"label\", 6)(9, \"span\", 7);\n            i0.ɵɵtext(10, \"Full Name\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelement(11, \"input\", 8);\n            i0.ɵɵtemplate(12, RegisterComponent_label_12_Template, 3, 0, \"label\", 9);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(13, \"div\", 5)(14, \"label\", 6)(15, \"span\", 7);\n            i0.ɵɵtext(16, \"Email\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelement(17, \"input\", 10);\n            i0.ɵɵtemplate(18, RegisterComponent_label_18_Template, 3, 0, \"label\", 9)(19, RegisterComponent_label_19_Template, 3, 0, \"label\", 9);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(20, RegisterComponent_div_20_Template, 6, 3, \"div\", 11);\n            i0.ɵɵelementStart(21, \"div\", 5)(22, \"label\", 6)(23, \"span\", 7);\n            i0.ɵɵtext(24, \"Phone\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelement(25, \"input\", 12);\n            i0.ɵɵtemplate(26, RegisterComponent_label_26_Template, 3, 0, \"label\", 9);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(27, \"div\", 5)(28, \"label\", 6)(29, \"span\", 7);\n            i0.ɵɵtext(30, \"Blood Group\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(31, \"select\", 13)(32, \"option\", 14);\n            i0.ɵɵtext(33, \"Select\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(34, RegisterComponent_option_34_Template, 2, 2, \"option\", 15);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(35, RegisterComponent_label_35_Template, 3, 0, \"label\", 9);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(36, \"div\", 5)(37, \"label\", 6)(38, \"span\", 7);\n            i0.ɵɵtext(39, \"City\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelement(40, \"input\", 16);\n            i0.ɵɵtemplate(41, RegisterComponent_label_41_Template, 3, 0, \"label\", 9);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(42, \"div\", 5)(43, \"label\", 6)(44, \"span\", 7);\n            i0.ɵɵtext(45, \"Last Donation Date (optional)\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelement(46, \"input\", 17);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(47, \"div\", 5)(48, \"label\", 18)(49, \"span\", 7);\n            i0.ɵɵtext(50, \"Available for donation\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(51, \"input\", 19);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(52, \"div\", 20)(53, \"button\", 21);\n            i0.ɵɵtemplate(54, RegisterComponent_span_54_Template, 2, 1, \"span\", 22)(55, RegisterComponent_span_55_Template, 1, 0, \"span\", 23);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(56, RegisterComponent_span_56_Template, 2, 1, \"span\", 24)(57, RegisterComponent_span_57_Template, 2, 1, \"span\", 25);\n            i0.ɵɵelementEnd()()();\n          }\n          if (rf & 2) {\n            let tmp_4_0;\n            let tmp_5_0;\n            let tmp_7_0;\n            let tmp_9_0;\n            let tmp_12_0;\n            let tmp_13_0;\n            let tmp_14_0;\n            let tmp_16_0;\n            let tmp_17_0;\n            let tmp_18_0;\n            i0.ɵɵadvance(2);\n            i0.ɵɵtextInterpolate1(\" \", ctx.isUpdateMode ? \"Update Donor Details\" : \"Donor Registration\", \" \");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.isUpdateMode);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.isUpdateMode);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"formGroup\", ctx.form);\n            i0.ɵɵadvance(6);\n            i0.ɵɵclassProp(\"input-error\", ((tmp_4_0 = ctx.form.get(\"name\")) == null ? null : tmp_4_0.invalid) && ((tmp_4_0 = ctx.form.get(\"name\")) == null ? null : tmp_4_0.touched));\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ((tmp_5_0 = ctx.form.get(\"name\")) == null ? null : tmp_5_0.invalid) && ((tmp_5_0 = ctx.form.get(\"name\")) == null ? null : tmp_5_0.touched));\n            i0.ɵɵadvance(5);\n            i0.ɵɵclassProp(\"input-disabled\", ctx.isUpdateMode)(\"input-error\", ((tmp_7_0 = ctx.form.get(\"email\")) == null ? null : tmp_7_0.invalid) && ((tmp_7_0 = ctx.form.get(\"email\")) == null ? null : tmp_7_0.touched) && !ctx.isUpdateMode);\n            i0.ɵɵproperty(\"readonly\", ctx.isUpdateMode);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.isUpdateMode && ((tmp_9_0 = ctx.form.get(\"email\")) == null ? null : tmp_9_0.invalid) && ((tmp_9_0 = ctx.form.get(\"email\")) == null ? null : tmp_9_0.touched));\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.isUpdateMode);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.isUpdateMode);\n            i0.ɵɵadvance(5);\n            i0.ɵɵclassProp(\"input-error\", ((tmp_12_0 = ctx.form.get(\"phone\")) == null ? null : tmp_12_0.invalid) && ((tmp_12_0 = ctx.form.get(\"phone\")) == null ? null : tmp_12_0.touched));\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ((tmp_13_0 = ctx.form.get(\"phone\")) == null ? null : tmp_13_0.invalid) && ((tmp_13_0 = ctx.form.get(\"phone\")) == null ? null : tmp_13_0.touched));\n            i0.ɵɵadvance(5);\n            i0.ɵɵclassProp(\"select-error\", ((tmp_14_0 = ctx.form.get(\"bloodGroup\")) == null ? null : tmp_14_0.invalid) && ((tmp_14_0 = ctx.form.get(\"bloodGroup\")) == null ? null : tmp_14_0.touched));\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngForOf\", ctx.bloodGroups);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ((tmp_16_0 = ctx.form.get(\"bloodGroup\")) == null ? null : tmp_16_0.invalid) && ((tmp_16_0 = ctx.form.get(\"bloodGroup\")) == null ? null : tmp_16_0.touched));\n            i0.ɵɵadvance(5);\n            i0.ɵɵclassProp(\"input-error\", ((tmp_17_0 = ctx.form.get(\"city\")) == null ? null : tmp_17_0.invalid) && ((tmp_17_0 = ctx.form.get(\"city\")) == null ? null : tmp_17_0.touched));\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ((tmp_18_0 = ctx.form.get(\"city\")) == null ? null : tmp_18_0.invalid) && ((tmp_18_0 = ctx.form.get(\"city\")) == null ? null : tmp_18_0.touched));\n            i0.ɵɵadvance(12);\n            i0.ɵɵproperty(\"disabled\", ctx.loading || !ctx.isUpdateMode && ctx.form.invalid);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.successMsg);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.errorMsg);\n          }\n        },\n        dependencies: [i4.NgForOf, i4.NgIf, i1.ɵNgNoValidate, i1.NgSelectOption, i1.ɵNgSelectMultipleOption, i1.DefaultValueAccessor, i1.CheckboxControlValueAccessor, i1.SelectControlValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName],\n        encapsulation: 2\n      });\n    }\n  }\n  return RegisterComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}